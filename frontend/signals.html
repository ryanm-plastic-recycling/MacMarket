<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trade Signals - MacMarket</title>
  <link rel="stylesheet" href="/style.css" />
  <script src="/theme.js" defer></script>
  <script src="/ticker.js" defer></script>
  <link rel="stylesheet" href="/indicators.css?v=12" />
  <style>
    /* --- layout helpers for the rearranged bits --- */
    .controls-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;           /* left: form+tabs, right: readiness */
      gap: 16px;
      align-items: start;
      margin: 10px 0 14px;
    }
    .controls-left {
      display: grid;
      gap: 14px;                                /* space between form and tabs/mindset row */
    }
    .controls-grid .row-controls { margin: 0; }
    .controls-grid .overview-readiness {
      display: grid; gap: 8px; justify-items: center;
    }

    /* two-up row for Advanced Tabs + Mindset inside the top controls-left */
    .pair-inline {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 1100px) {
      .controls-grid { grid-template-columns: 1fr; }
      .pair-inline { grid-template-columns: 1fr; }
    }

    .mini-stack { display: grid; gap: 8px; margin-top: 8px; }
    .mini-group { display: grid; gap: 4px; }
    .mini-title {
      font-size: .9rem; opacity: .85; padding-left: 2px;
      text-transform: uppercase; letter-spacing: .04em;
    }

    /* panels below the top mini strips should be 2x2 */
    #panels-below-top { display: grid; gap: 14px; margin-top: 14px; }
    #panels-below-top .panels-grid {
      display: grid; gap: 14px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    /* keep the original chart column stretchy */
    #signals-top .chart-col { min-width: 0; }

    /* news/tech summary cards */
    #signal-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
      margin-top: 10px !important;
    }
    #signal-container > div {
      background: rgba(15,23,42,.45);
      border: 1px solid rgba(148,163,184,.15);
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 6px 22px rgba(0,0,0,.25);
    }

    /* shared two-up pairs used further down the page */
    .pair-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items: start;
      margin: 16px 0;
    }
    @media (max-width: 1100px) {
      .pair-grid { grid-template-columns: 1fr; }
    }
    .pair-grid .overview-entries,
    .pair-grid .overview-exits,
    .pair-grid .overview-tabs,
    .pair-grid .overview-mindset {
      background: rgba(15, 23, 42, 0.35);
      border: 1px solid rgba(148, 163, 184, 0.15);
      border-radius: 12px;
      padding: 12px;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <a href="index.html">Home</a>
    <a href="login.html">Login</a>
    <a href="account.html">Account</a>
    <a href="tickers.html">Tickers</a>
    <a href="signals.html">Signals</a>
    <a href="alerts.html">Alerts</a>
    <a href="journal.html">Journal</a>
    <a href="backtests.html">Backtests</a>
    <a href="github.html">GitHub</a>
    <a href="help.html#signals">Help</a>
    <a href="admin.html" id="admin-link" style="display:none;">Admin</a>
    <a href="#" id="logout-link">Logout</a>
    <button id="theme-toggle">Toggle Theme</button>
  </div>

  <header>
    <img id="header-logo" src="images/logo-light.png" alt="Logo" />
    <h1>MacMarket</h1>
    <div id="user-info"></div>
    <div id="time"></div>
    <div id="status"></div>
  </header>

  <main class="signals-page">
    <div id="ticker-bar">
      <button id="ticker-toggle">Pause</button>
      <div id="ticker-track"></div>
    </div>

    <h2>Signals</h2>

    <section class="overview-watchlist">
      <h3>Watchlist</h3>
      <ul id="watchlist-list" class="watchlist-list"></ul>
    </section>
    <section class="overview-live">
      <h3>Top 10 Signals - Live by Mode &amp; Best Readiness %</h3>
      <ul id="live-top-list" class="watchlist-list"></ul>
    </section>

    <!-- === TOP SECTION === -->
    <section id="signals-top" class="signal-section span-2">
      <h3 style="margin-top:6">Symbol Signal</h3>

      <!-- NEW: one-row layout: Form → Tabs → Mindset → Readiness -->
      <div class="controls-grid four-up">
        <!-- 1) Symbol / Mode / Run -->
        <form id="symbol-form" class="row-controls" onsubmit="return false">
          <label>Symbol
            <input id="symbol" type="text" value="SPY" spellcheck="false" />
          </label>
          <label>Mode
            <select id="mode-select" aria-label="Trading mode">
              <option value="crypto">Crypto</option>
              <option value="day">Day</option>
              <option value="position">Position</option>
              <option value="swing" selected>Swing</option>
            </select>
          </label>
          <button id="get-signal" type="submit" aria-label="Run HACO">Run</button>
          <small class="subnote">Updating MODE runs top 10 signals; may take a moment.</small>
        </form>
      
        <!-- 2) Advanced Tabs -->
        <section class="overview-tabs slim-card">
          <h4>Advanced Tabs</h4>
          <div class="tabs-shell">
            <nav id="advanced-tabs-nav" class="tabs-nav"></nav>
            <div id="advanced-tab-content" class="tabs-content"></div>
          </div>
        </section>
      
        <!-- 3) Mindset -->
        <section class="overview-mindset slim-card">
          <h4>Mindset</h4>
          <p id="mindset-tagline" class="muted"></p>
          <ul id="mindset-focus" class="mindset-focus"></ul>
        </section>
      
        <!-- 4) Readiness summary -->
        <aside class="overview-readiness">
          <div id="readiness-score" class="readiness-score">--</div>
          <ul id="readiness-components" class="readiness-components"></ul>
        </aside>
      </div>

      <!-- Entries + Exits side-by-side (unchanged) -->
      <div class="pair-grid">
        <section class="overview-entries">
          <h4>Entries</h4>
          <ul id="entries-list" class="entries-list"></ul>
        </section>

        <section class="overview-exits">
          <h4>Exits</h4>
          <div id="exits-summary"></div>
        </section>
      </div>

      <!-- Chart + minis + panels -->
      <div class="chart-col">
        <div id="signals-chart" class="chart-frame"></div>

        <!-- top minis with labels -->
        <div id="signals-mini-strips" class="mini-stack">
          <div class="mini-group">
            <div class="mini-title">HACO</div>
            <div id="mini-haco" class="mini-strip"></div>
          </div>
          <div class="mini-group">
            <div class="mini-title">HACOLT</div>
            <div id="mini-hacolt" class="mini-strip"></div>
          </div>
        </div>

        <!-- news/tech summaries (no sub-chart) -->
        <div id="signal-container" style="margin-top:1rem">
          <div>
            <h4>News Sentiment</h4>
            <div id="news-output"></div>
            <small>Higher score indicates more positive news coverage.</small>
          </div>
          <div>
            <h4>Technical Signal</h4>
            <div id="tech-output"></div>
            <small>Based on 20/50 day moving average crossover.</small>
          </div>
        </div>

        <!-- panels moved here under the top minis; force 2x2 -->
        <div id="panels-below-top">
          <div id="panels-grid" class="panels-grid"></div>
        </div>
      </div>
    </section>

    <!-- === HACO STRATEGY === -->
    <section class="signal-section span-2" id="haco-section">
      <h3>HACO Strategy</h3>
      <form id="haco-form" class="row" onsubmit="return false" style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
        <label>Symbol <input id="haco-symbol" value="SPY" /></label>
        <label>Timeframe
          <select id="haco-timeframe">
            <option>Day</option>
            <option>Hour</option>
            <option>4h</option>
            <option>Week</option>
            <option>Month</option>
          </select>
        </label>
        <label>Length Up <input id="haco-lenUp" value="34" type="number" min="1" /></label>
        <label>Length Down <input id="haco-lenDown" value="34" type="number" min="1" /></label>
        <label>Alert Lookback <input id="haco-alertLookback" value="1" type="number" min="1" /></label>
        <label>Lookback <input id="haco-lookback" value="200" type="number" min="50" /></label>
        <label><input type="checkbox" id="haco-toggleHa" /> Show Heikin-Ashi</label>
        <button id="haco-run" type="submit">Run</button>
      </form>

      <div id="haco-chart" style="height:420px; position:relative;"></div>

      <!-- HACO minis with labels -->
      <div id="haco-mini-strips" class="mini-stack">
        <div class="mini-group">
          <div class="mini-title">HACO</div>
          <div id="haco-mini-haco" class="mini-strip"></div>
        </div>
        <div class="mini-group">
          <div class="mini-title">HACOLT</div>
          <div id="haco-mini-hacolt" class="mini-strip"></div>
        </div>
      </div>

      <div id="haco-toast" class="toast" style="display:none;"></div>
      <div id="haco-explain"></div>
    </section>

    <!-- Recommendations -->
    <section class="signal-section span-2">
      <h3>Recommendations to Invest</h3>
      <button id="get-recs">Get Recommendations</button>
      <table id="recs-table">
        <thead>
          <tr><th>Symbol</th><th>Action</th><th>Exit</th><th>Probability</th><th>Reason</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Macro -->
    <section class="signal-section span-2">
      <h3>Macro Outlook</h3>
      <textarea id="macro-text" rows="5" cols="60" placeholder="Paste macroeconomic summary..."></textarea>
      <br /><button id="run-macro">Analyze</button>
      <div id="macro-output"></div>
      <small>LLM interpretation of the provided text.</small>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.2.2/dist/lightweight-charts.standalone.production.js"></script>
  <script src="/js/signals.js?v=1"></script>
  <script src="/js/haco-ui.js?v=15"></script>
  <script src="/js/haco-scan.js?v=18"></script>
  <script src="help.js"></script>

  <!-- helper: upgrade PASS/FAIL footers into badges -->
  <script>
    (function enhanceStatusBadges(){
      const grid = document.getElementById('panels-grid');
      if (!grid) return;
      const upgrade = () => {
        grid.querySelectorAll('.panel-card').forEach(card => {
          const ft = card.querySelector('footer');
          if (!ft) return;
          const t = (ft.textContent || '').trim().toUpperCase();
          card.classList.remove('is-pass','is-fail');
          if (t === 'PASS') card.classList.add('is-pass');
          else if (t === 'FAIL') card.classList.add('is-fail');
        });
      };
      const obs = new MutationObserver(upgrade);
      obs.observe(grid, { childList: true, subtree: true });
      upgrade();
    })();
  </script>
</body>
</html>
